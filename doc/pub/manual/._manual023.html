<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="DocOnce Description">
<meta name="keywords" content="doconce short explanation,demos,headlines,section headings,inline tagging,emphasized words,boldface words,verbatim text,inline comments,non-breaking space,nbsp,quotation syntax,non-breaking space,footnotes,cross referencing,labels,references,index,some index entry,main entry subentry,doconce format options,command-line options doconce format">

<title>DocOnce Description</title>

<!-- Bootstrap style: bootswatch_readable -->
<link href="http://netdna.bootstrapcdn.com/bootswatch/3.1.1/readable/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->


</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [(' What Is DocOnce? ', 1, 'what:is:doconce', 'what:is:doconce'),
              (' Demos ', 2, None, '___sec1'),
              (' Markup Based on Special Lines ', 1, None, '___sec2'),
              (' Heading with title and author(s) ', 2, None, '___sec3'),
              (' Table of contents ', 2, None, '___sec4'),
              (' Section headings ', 2, None, '___sec5'),
              (' Figures ', 2, None, '___sec6'),
              (' Movies ', 2, None, '___sec7'),
              (' The Basic Command ', 3, None, '___sec8'),
              (' MP4, WebM, and Ogg Movies in HTML ', 3, None, '___sec9'),
              (' Movie Handling in Various Formats ', 3, None, '___sec10'),
              (' YouTube and Vimeo Movies ', 3, None, '___sec11'),
              (' Animation Based on Filename Generators ',
               3,
               None,
               '___sec12'),
              (' Copying Computer Code from Source Files ',
               2,
               None,
               '___sec13'),
              (' Inserting the Output from Operating System Commands ',
               2,
               None,
               '___sec14'),
              (' Comments ', 2, None, '___sec15'),
              (' Tables ', 2, None, '___sec16'),
              (' Basic Syntax ', 3, None, '___sec17'),
              (' Tables to/from CSV Data Files ', 3, None, '___sec18'),
              (' Lists ', 2, None, '___sec19'),
              (' Inline Tagging ', 1, 'inline:tagging', 'inline:tagging'),
              (' Emphasized Words ', 2, None, '___sec21'),
              (' Inline Verbatim Text ', 2, None, '___sec22'),
              (' Links to Web Addresses ', 2, None, '___sec23'),
              (' Links to Mail Addresses ', 2, None, '___sec24'),
              (' Links to Local Files ', 2, None, '___sec25'),
              (' Quotes ', 2, None, '___sec26'),
              (' Non-Breaking Space ', 2, None, '___sec27'),
              (' Horizontal rule ', 2, None, '___sec28'),
              (' Em-dash ', 2, None, '___sec29'),
              (' Ampersand ', 2, None, '___sec30'),
              (' Footnotes ', 2, None, '___sec31'),
              (' Inline Comments ', 2, None, '___sec32'),
              (' Inline Comments for Editing ', 2, None, '___sec33'),
              (' Forced Line Breaks ', 2, None, '___sec34'),
              (' Inline Mathematics ', 2, None, '___sec35'),
              (' Cross-Referencing ', 2, None, '___sec36'),
              (' Generalized Cross-Referencing ',
               2,
               'manual:genrefs',
               'manual:genrefs'),
              (' A Worked Example ', 3, None, '___sec38'),
              (' Index ', 2, None, '___sec39'),
              (' Emojis ', 2, None, '___sec40'),
              (' Environments ', 1, None, '___sec41'),
              (' Exercises, Problems, Projects, and Examples ',
               2,
               None,
               '___sec42'),
              (' List of Exercises, Problems, and Projects ',
               3,
               None,
               '___sec43'),
              (' Blocks of Verbatim Computer Code ',
               2,
               'sec:verbatim:blocks',
               'sec:verbatim:blocks'),
              (' LaTeX Blocks of Mathematical Text ',
               2,
               'mathtext',
               'mathtext'),
              (' Support of LaTeX Math in Various Output Formats ',
               3,
               None,
               '___sec46'),
              (' Dealing with Mathematics in Formats without LaTeX Math Support ',
               3,
               None,
               '___sec47'),
              (' Mathematics for PowerPoint/OpenOffice ',
               3,
               None,
               '___sec48'),
              (' Macros (Newcommands) ', 2, 'newcommands', 'newcommands'),
              (' Guidelines for LaTeX Writers ', 2, None, '___sec50'),
              (' Typesetting of Algorithms ', 2, None, '___sec51'),
              (' Admonitions ', 2, None, '___sec52'),
              (' Examples on Admonition Types ', 3, None, '___sec53'),
              (' Layout of admonitions in HTML ', 3, None, '___sec54'),
              (' Layout of admonitions in LaTeX ', 3, None, '___sec55'),
              (' LaTeX code environments inside admonitions ',
               3,
               None,
               '___sec56'),
              (' The Box Environment ', 3, None, '___sec57'),
              (' Bibliography (References) ', 1, None, '___sec58'),
              (' Importing your data to the Publish database ',
               2,
               None,
               '___sec59'),
              (' Requirements to input data ', 2, None, '___sec60'),
              (' Adding new references to the database ',
               2,
               None,
               '___sec61'),
              (' Exporting the database ', 2, None, '___sec62'),
              (' Referring to publications ', 2, None, '___sec63'),
              (' Specifying the Publish database ', 2, None, '___sec64'),
              (' LaTeX Bibliography Style ', 2, None, '___sec65'),
              (' Preprocessing and Postprocessing ', 1, None, '___sec66'),
              (' The Preprocess and Mako Preprocessors ',
               2,
               None,
               '___sec67'),
              (' Splitting Documents into Smaller Pieces ',
               2,
               None,
               '___sec68'),
              (' Writing Slides ', 1, None, '___sec69'),
              (' Overview ', 2, None, '___sec70'),
              (' Slide Elements ', 2, None, '___sec71'),
              (' Title page ', 3, None, '___sec72'),
              (' Parts page ', 3, None, '___sec73'),
              (' Standard bullet list page ', 3, None, '___sec74'),
              (' Equations, movies, figures ', 3, None, '___sec75'),
              (' HTML5 Slides ', 2, None, '___sec76'),
              (' Potential Problems ', 3, None, '___sec77'),
              (' LaTeX Beamer Slides ', 2, None, '___sec78'),
              (' Themes ', 3, None, '___sec79'),
              (' Pop of items and blocks ', 3, None, '___sec80'),
              (' Misc ', 1, None, '___sec81'),
              (' Missing Features ', 2, None, '___sec82'),
              (' Emacs DocOnce Formatter ',
               2,
               'emacs:doconce',
               'emacs:doconce'),
              (' Mako Programming ', 1, 'manual:mako', 'manual:mako'),
              (' The Basics of Mako ', 2, None, '___sec85'),
              (' Debugging Python code in Mako ',
               2,
               'mako:py:debugging',
               'mako:py:debugging'),
              (' Example: Executing Python and using SymPy Objects in LaTeX ',
               2,
               None,
               '___sec87'),
              (' Example: Extending Tables to Handle Figures ',
               2,
               'manual:tables:wfigs',
               'manual:tables:wfigs'),
              (' Solution for LaTeX and HTML ', 3, None, '___sec89'),
              (' Generating the Entire Table ', 3, None, '___sec90'),
              (' Generating the Entire Table in a Native Format via Mako ',
               3,
               None,
               '___sec91'),
              (' Generating the Entire Table in a Native Format as a Post Process ',
               3,
               None,
               '___sec92'),
              (' Example: Defining a Theorem Environment ',
               2,
               'manual:theorem:envir',
               'manual:theorem:envir'),
              (' Tools for Writing DocOnce Documents ', 2, None, '___sec94'),
              (' Debugging ', 2, None, '___sec95'),
              (' From DocOnce to Other Formats ',
               1,
               'doconce2formats',
               'doconce2formats'),
              (' Generating a makefile ', 2, None, '___sec97'),
              (' Preprocessing ', 2, None, '___sec98'),
              (' Removal of inline comments ', 2, None, '___sec99'),
              (' Notes ', 2, None, '___sec100'),
              (' Demo of different formats ', 2, None, '___sec101'),
              (' HTML ', 2, None, '___sec102'),
              (' Basics ', 3, None, '___sec103'),
              (' Typesetting of Code ', 3, None, '___sec104'),
              (' Handling of Movies ', 3, None, '___sec105'),
              (' HTML Styles ', 3, None, '___sec106'),
              (' HTML templates ', 3, None, '___sec107'),
              (' The HTML File Collection ', 3, None, '___sec108'),
              (' Filenames ', 3, None, '___sec109'),
              (' Blog Posts ', 2, None, '___sec110'),
              (' Pandoc and Markdown ', 2, None, '___sec111'),
              (' Markdown to HTML conversion ', 3, None, '___sec112'),
              (' Using Pandoc to go from LaTeX to MS Word or HTML ',
               3,
               None,
               '___sec113'),
              (' Strict Markdown ', 3, None, '___sec114'),
              (' GitHub-flavored Markdown ', 3, None, '___sec115'),
              (' MultiMarkdown ', 3, None, '___sec116'),
              (' Strapdown rendering of Markdown text ',
               3,
               None,
               '___sec117'),
              (' LaTeX ', 2, None, '___sec118'),
              (' PDFLaTeX ', 2, None, '___sec119'),
              (' XeLaTeX ', 2, None, '___sec120'),
              (' From PDF to e-book formats ', 2, None, '___sec121'),
              (' Microsoft Word or LibreOffice ', 2, None, '___sec122'),
              (' Plain ASCII Text ', 2, None, '___sec123'),
              (' reStructuredText ', 2, None, '___sec124'),
              (' Sphinx ', 2, None, '___sec125'),
              (' The manual Sphinx procedure ', 3, None, '___sec126'),
              (' Wiki Formats ', 2, None, '___sec127'),
              (' Google Docs ', 2, None, '___sec128'),
              (' Tweaking the DocOnce Output ', 2, None, '___sec129'),
              (' Options for the `doconce` commands ', 1, None, '___sec130'),
              (' `doconce format` command-line options ',
               2,
               None,
               '___sec131'),
              (' Installation of DocOnce and its Dependencies ',
               1,
               'install:doconce',
               'install:doconce'),
              (' DocOnce ', 2, None, '___sec133'),
              (' Dependencies ', 2, None, '___sec134'),
              (' Preprocessors ', 3, None, '___sec135'),
              (' Image file handling ', 3, None, '___sec136'),
              (' Spellcheck ', 3, None, '___sec137'),
              (' Bibliography ', 3, None, '___sec138'),
              (' Ptex2tex for LaTeX Output ', 3, None, '___sec139'),
              (' LaTeX packages ', 3, None, '___sec140'),
              (' reStructuredText (reST) Output ', 3, None, '___sec141'),
              (' Sphinx Output ', 3, None, '___sec142'),
              (' Markdown and Pandoc Output ', 3, None, '___sec143'),
              (' Epydoc Output ', 3, None, '___sec144'),
              (' Analyzing file differences ', 3, None, '___sec145'),
              (' Quick Debian/Ubuntu Install ',
               2,
               'install:debian:script',
               'install:debian:script'),
              (' Basic Parsing Ideas ', 1, None, '___sec147'),
              (' Typesetting of Function Arguments, Return Values, and Variables ',
               2,
               None,
               '___sec148'),
              (' References ', 1, None, '___sec149')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="manual.html">DocOnce Description</a>
  </div>
  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._manual000.html#what:is:doconce" style="font-size: 80%;">What Is DocOnce?</a></li>
     <!-- navigation toc: --> <li><a href="._manual003.html#___sec2" style="font-size: 80%;">Markup Based on Special Lines</a></li>
     <!-- navigation toc: --> <li><a href="._manual010.html#inline:tagging" style="font-size: 80%;">Inline Tagging</a></li>
     <!-- navigation toc: --> <li><a href="._manual013.html#___sec41" style="font-size: 80%;">Environments</a></li>
     <!-- navigation toc: --> <li><a href="._manual017.html#___sec58" style="font-size: 80%;">Bibliography (References)</a></li>
     <!-- navigation toc: --> <li><a href="._manual018.html#___sec66" style="font-size: 80%;">Preprocessing and Postprocessing</a></li>
     <!-- navigation toc: --> <li><a href="._manual020.html#___sec69" style="font-size: 80%;">Writing Slides</a></li>
     <!-- navigation toc: --> <li><a href="._manual021.html#___sec81" style="font-size: 80%;">Misc</a></li>
     <!-- navigation toc: --> <li><a href="#manual:mako" style="font-size: 80%;">Mako Programming</a></li>
     <!-- navigation toc: --> <li><a href="._manual028.html#doconce2formats" style="font-size: 80%;">From DocOnce to Other Formats</a></li>
     <!-- navigation toc: --> <li><a href="._manual028.html#___sec130" style="font-size: 80%;">Options for the `doconce` commands</a></li>
     <!-- navigation toc: --> <li><a href="._manual029.html#install:doconce" style="font-size: 80%;">Installation of DocOnce and its Dependencies</a></li>
     <!-- navigation toc: --> <li><a href="._manual029.html#___sec147" style="font-size: 80%;">Basic Parsing Ideas</a></li>
     <!-- navigation toc: --> <li><a href="._manual029.html#___sec149" style="font-size: 80%;">References</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<a name="part0023"></a>
<!-- !split -->

<h1 id="manual:mako">Mako Programming<a name="manual:mako"></a></h1>

<p>
The <a href="http://docs.makotemplates.org/" target="_self">Mako</a> templating engine is used
as preprocessor for DocOnce documents, but the <a href="http://code.google.com/p/preprocess" target="_self">Preprocess</a> is run prior to Mako and is recommended for
including other files via <code># #include &quot;filename&quot;</code>. Preprocess is also
sufficient for if-else tests to steer which parts of the text that
are to be compiled. For more demanding tasks, use Mako, which resembles
a real programming language.

<p>
<div class="alert alert-block alert-danger alert-text-normal"><b>Warning.</b>
Unfortunately, the combination of Mako and LaTeX mathematics may
lead to problems because Mako applies syntax like <code>${var}</code> to extract
variables or call functions, while LaTeX mathematics sometimes applies
the same syntax, e.g., <code>${\cal O}(\Delta x^2)$</code> which looks like a
Mako function call. This problem can give rise to strange error
messages from Mako, usually that a variable is not defined.
The solution is to avoid such Mako-style syntax when writing
LaTeX mathematics, e.g., by defining newcommands if it is otherwise
problematic.
</div>


<h2 id="___sec85">The Basics of Mako <a name="___sec85"></a></h2>

<p>
Just a preliminary sketch of some Mako code (next example is better!):

<p>

<!-- code=doconce (!bc do) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic"># Define variables</span>
&lt;%
mycounter = 1
mydict = {}
%&gt;

<span style="color: #408080; font-style: italic"># Assume MYVAR is given on the command line as MYVAR=mytext (e.g.)</span>
% if MYVAR is not UNDEFINED:
The value of MYVAR is ${MYVAR}.
% endif

&lt;%
<span style="color: #408080; font-style: italic">## Manipulation of variables</span>
mycounter += 1
%&gt;

% if MYVAR in (2,4,6):
MYVAR is even integer in [2,6].
% elif MYVAR &gt; 1000000:
MYVAR is big.
% else:
MYVAR=${MYVAR}, mycounter=${mycounter}.
% endif

<span style="color: #408080; font-style: italic"># Function</span>
&lt;%
<span style="color: #408080; font-style: italic"># Define Python function: FORMAT and DEVICE</span>
<span style="color: #408080; font-style: italic"># are always defined</span>

def link(filename):
    url = &quot;https://github.com/some/path/to/&#39; + filename + &#39;&quot;&#39;
    if DEVICE == &#39;screen&#39;:
        # make link to url
        return &#39;&quot;filename&quot;:&#39; + url
    elif DEVICE == &#39;paper&#39;:
        # write URL explicit on paper
        return &#39;URL:&#39; + url
%&gt;

&lt;%doc&gt;
This
is
a
block
comment in Mako.
&lt;%doc/&gt;
</pre></div>

<h2 id="mako:py:debugging">Debugging Python code in Mako<a name="mako:py:debugging"></a></h2>

<p>
Although it is easy to put in Python code inside <code>&lt;%</code> and <code>%&gt;</code> directives,
it may quickly become a nightmare to debug the Python code. If Mako
reports a syntax error in the Python code, it is recommended to debug
the Python code outside of Mako. That is, copy all Python code to a
separate file and run it as standard Python code. This will give much
more precise (and familiar) error messages.

<p>
A setup that is easy for developing and maintaining the Python code
used in Mako goes as follows. Different pieces of Python code in Mako
is placed in separate files and included via the Preprocess preprocessor
in the DocOnce document. For instance,

<p>

<!-- code=doconce (!bc do) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic">## Define Mako variables and basic functions</span>
&lt;%
<span style="color: #408080; font-style: italic"># #include &quot;variables.py&quot;</span>
<span style="color: #408080; font-style: italic"># #include &quot;basic_functions.py&quot;</span>
%&gt;

Some DocOnce text ....

<span style="color: #408080; font-style: italic">## Define more functions</span>
&lt;%
<span style="color: #408080; font-style: italic"># #include &quot;more_functions.py&quot;</span>
%&gt;
</pre></div>
<p>
Here, we have separated the Python code in Mako into three files:
<code>variables.py</code>, <code>basic_functions.py</code>, and <code>more_functions.py</code>.
With the <code># #include</code> statements, Mako sees the <code>.py</code> files inserted
as text inside the <code>&lt;%</code> and <code>%&gt;</code> directives (check the file
<code>tmp_preprocess__mydoc.do.txt</code> for the result of running Preprocess and
the complete DocOnce file that Mako sees).

<p>
To debug the <code>.py</code> files, collect all their text in one single <code>.py</code>
file and run it. The recommended way is to use Preprocess to copy
all the text in the <code>.py</code> files into a single file, named (say) <code>all_code.p.py</code>:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic"># --*-- coding: utf-8 -*-</span>
<span style="color: #408080; font-style: italic"># (Encoding info cannot be in mako code, but required here</span>
<span style="color: #408080; font-style: italic"># in Python code if we use non-ascii characters)</span>

<span style="color: #408080; font-style: italic"># #include &quot;variables.py&quot;</span>
<span style="color: #408080; font-style: italic"># #include &quot;basic_functions.py&quot;</span>
<span style="color: #408080; font-style: italic"># #include &quot;more_functions.py&quot;</span>

<span style="color: #408080; font-style: italic"># Test the code included above</span>
<span style="color: #008000; font-weight: bold">print</span> some_func(<span style="color: #666666">1</span>, <span style="color: #BA2121">&#39;arg&#39;</span>)
</pre></div>
<p>
Note that after including the <code>.py</code> files one can insert calls to functions,
print variables, etc., as desired to debug and experiment.

<p>
Run Preprocess on <code>all_code.p.py</code> to produce an ordinary Python file
<code>all_code.py</code> and run that code to test and debug. A little shell script
<code>all_code.sh</code> doing both these things is convenient:

<p>

<!-- code=bash (!bc shpro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic">#!/bin/sh</span>
preprocess all_code.p.py &gt; all_code.py
python all_code.py
</pre></div>
<p>
Especially when the Python code in Mako grows and becomes non-trivial,
this setup for having the code external to the DocOnce document is
very effective.

<p>
<div class="alert alert-block alert-warning alert-text-normal"><b>Things to remember when programming Mako.</b>

<ul>
 <li> Do not use continuation character (backslash) in Python code.</li>
 <li> When a Mako error refers to a line in the text, invoke the
   file that Mako sees: <code>tmp_preprocess__mydoc.do.txt</code> if
   the DocOnce file has name <code>mydoc.do.txt</code>.</li>
 <li> Use double <code>##</code> (Mako comment) to comment out Mako calls
   of the form <code>${name...}</code>.</li>
</ul>

And to be repeated: keep the Python code in separate files!
</div>


<p>
One can use Mako to extend the DocOnce syntax. Three examples are given next.

<p>
<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pager">
  <li class="previous">
    <a href="._manual022.html">&larr; Prev</a>
  </li>
  <li class="next">
    <a href="._manual024.html">Next &rarr;</a>
  </li>
</ul>
<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


</body>
</html>
    

